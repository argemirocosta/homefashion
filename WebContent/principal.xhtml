<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

<h:head>
	<title>Principal</title>

	<link href="css/style.css" type="text/css" rel="stylesheet" />

</h:head>
<h:body>

	<p:idleMonitor timeout="600000">
		<p:ajax event="idle" listener="#{usuarioSessionController.timeOut}" />
	</p:idleMonitor>

	<p:dialog widgetVar="dlgCadPlanta" header="Cadastrar Cliente"
		height="auto" width="auto" draggable="true" resizable="false"
		modal="true">
		<h:form id="formCad">
			<p:panelGrid columns="2" styleClass="semBorda">
				<p:outputLabel value="Nome: " />
				<p:inputText value="#{clienteController.p.nome}" maxlength="30"
					size="25" required="true" requiredMessage="Insira o nome" />

				<p:outputLabel value="Telefone 1: " />
				<p:inputText value="#{clienteController.p.telefone1}" maxlength="30"
					size="25" required="false"
					requiredMessage="Insira ao menos 1 telefone" />

				<p:outputLabel value="Telefone 2: " />
				<p:inputText value="#{clienteController.p.telefone2}" maxlength="30"
					size="25" required="false" requiredMessage="insira o nome" />

			</p:panelGrid>

			<p:separator />

			<center>
				<p:panelGrid columns="2" styleClass="semBorda">
					<p:commandButton value="Cadastrar"
						action="#{clienteController.insereCliente()}"
						update=":formCad, :formTab" icon="confirmar" />
					<p:commandButton value="Fechar"
						onclick="PF('dlgCadPlanta').hide();" icon="cancelar" />
				</p:panelGrid>
			</center>



		</h:form>
	</p:dialog>

	<p:dialog widgetVar="dlgAltPlanta" header="Alterar Cliente"
		height="auto" width="auto" draggable="true" resizable="false"
		modal="true">
		<h:form id="formAlt">
			<p:panelGrid columns="2" styleClass="semBorda">
				<p:outputLabel value="Nome: " />
				<p:inputText value="#{clienteController.p.nome}" maxlength="30"
					size="25" required="true" requiredMessage="insira o nome" />

				<p:outputLabel value="Telefone 1: " />
				<p:inputText value="#{clienteController.p.telefone1}" maxlength="30"
					size="25" required="true"
					requiredMessage="Insira ao menos 1 telefone" />

				<p:outputLabel value="Telefone 2: " />
				<p:inputText value="#{clienteController.p.telefone2}" maxlength="30"
					size="25" required="false"
					requiredMessage="Insira ao menos 1 telefone" />

			</p:panelGrid>

			<p:separator />

			<center>
				<p:panelGrid columns="2" styleClass="semBorda">
					<p:commandButton value="Alterar"
						action="#{clienteController.editeCliente()}"
						update=":formAlt, :formTab" icon="confirmar" />
					<p:commandButton value="Fechar"
						onclick="PF('dlgAltPlanta').hide();" icon="cancelar" />
				</p:panelGrid>
			</center>


		</h:form>
	</p:dialog>

	<p:dialog widgetVar="dlgDeleteCliente" header="Deletar Cliente"
		height="auto" width="auto" draggable="true" resizable="false"
		modal="true">
		<h:form id="formDel">
			<p:panelGrid columns="2" styleClass="semBorda">
				<p:outputLabel value="Deseja realmente deletar esse cliente? " />

			</p:panelGrid>

			<p:separator />

			<center>
				<p:panelGrid columns="2" styleClass="semBorda">
					<p:commandButton value="Sim"
						action="#{clienteController.deleteCliente()}"
						update=":formAlt, :formTab" icon="confirmar" />
					<p:commandButton value="Fechar"
						onclick="PF('dlgDeleteCliente').hide();" icon="cancelar" />
				</p:panelGrid>
			</center>

		</h:form>
	</p:dialog>


	<h:form id="formTab">
		<p:growl id="msg" />


		<p:commandButton value="Sair" icon="cancelar"
			action="#{usuarioSessionController.logout()}" style="float:right;" />

		<p:commandButton value="Relatórios" icon="ui-icon-document"
			onclick="PF('dlgRelatorios').show();"
			style="float:right;margin-left:10px;" />

		<h1>Clientes</h1>

		<p:separator />

		<br />


		<p:panelGrid columns="7" styleClass="semBorda">
			<p:commandButton value="Novo" onclick="PF('dlgCadPlanta').show();"
				icon="novo" />
			<p:outputLabel value="Buscar por: " />

			<p:inputText id="cpBuscaNome" value="#{clienteController.campoBusca}"
				maxlength="30" size="25">

				<p:watermark for="cpBuscaNome" value="Digite o nome." />

			</p:inputText>


			<p:commandButton value="Buscar" action="#{clienteController.busca()}"
				update=":formTab" icon="buscar" />
			<p:commandButton value="Limpar"
				action="#{clienteController.limparBusca()}" update=":formTab"
				icon="limpar" />


		</p:panelGrid>

		<br />

		<p:dataTable id="tab" value="#{clienteController.listaCliente}"
			var="tabela" emptyMessage="Nenhum Cliente encontrado" rows="20"
			paginator="true" paginatorPosition="bottom">
			<p:column headerText="Código" width="15%">
				<center>
					<p:outputLabel value="#{tabela.id}" />
				</center>
			</p:column>

			<p:column headerText="Nome" width="40%">
				<p:outputLabel value="#{tabela.nome}" />
			</p:column>

			<p:column headerText="Telefone1" width="15%">
				<center>
					<p:outputLabel value="#{tabela.telefone1}" />
				</center>
			</p:column>

			<p:column headerText="Telefone2" width="15%">
				<center>
					<p:outputLabel value="#{tabela.telefone2}" />
				</center>
			</p:column>



			<p:column headerText="Ações" width="15%">

				<center>

					<p:commandButton onclick="PF('dlgAltPlanta').show();"
						update=":formTab, :formAlt" icon="alterar">
						<f:setPropertyActionListener value="#{tabela}"
							target="#{clienteController.p}" />
					</p:commandButton>

					<p:commandButton onclick="PF('dlgDeleteCliente').show();"
						update=":formTab" icon="cancelar">
						<f:setPropertyActionListener value="#{tabela}"
							target="#{clienteController.p}" />
					</p:commandButton>

					<p:commandButton onclick="PF('dlgVender').show();" icon="novo"
						action="#{vendaController.limparCampos}"
						update=":formVender:tabVendas">
						<f:setPropertyActionListener value="#{tabela}"
							target="#{vendaController.venda.cliente}" />
					</p:commandButton>

				</center>
			</p:column>

		</p:dataTable>

	</h:form>

	<p:dialog widgetVar="dlgVender" header="Realizar Vendas" height="auto"
		width="auto" draggable="true" resizable="false" modal="true"
		position="top">
		<h:form id="formVender">
			<p:panelGrid columns="2" styleClass="semBorda" id="pnlgridVender">
				<p:outputLabel value="Valor: " />
				<p:inputText value="#{vendaController.venda.valor}" maxlength="30"
					size="15" required="true" requiredMessage="Insira o valor" />

				<p:outputLabel value="Data: " />
				<p:calendar value="#{vendaController.venda.data}" showOn="button"
					required="true" requiredMessage="Insira a Data" size="15"></p:calendar>

				<p:outputLabel value="Quantidade: " />
				<p:inputText value="#{vendaController.venda.qtd}" maxlength="30"
					size="15" required="false" requiredMessage="Insira a quantidade" />

			</p:panelGrid>

			<p:separator />

			<center>
				<p:panelGrid columns="2" styleClass="semBorda">
					<p:commandButton value="Vender"
						action="#{vendaController.insereVenda()}"
						update=":formCad, :formTab, :formVender:pnlgridVender"
						icon="confirmar" />
					<p:commandButton value="Fechar" onclick="PF('dlgVender').hide();"
						icon="cancelar" />
				</p:panelGrid>
			</center>

			<p:separator />

			<br></br>

			<p:dataTable id="tabVendas" value="#{vendaController.listaVendas}"
				var="tabela"
				emptyMessage="Nenhuma venda realizada para esse cliente" rows="10"
				paginator="true" paginatorPosition="bottom">

				<p:column headerText="Nome" width="40%">
					<center>
						<p:outputLabel value="#{tabela.cliente.nome}" />
					</center>
				</p:column>

				<p:column headerText="Data" width="10%">
					<center>
						<p:outputLabel value="#{tabela.data}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Valor Venda" width="10%">
					<center>
						<p:outputLabel value="#{tabela.valor}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Total Pago" width="10%">
					<center>
						<p:outputLabel value="#{tabela.total_pago}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Em Aberto" width="10%">
					<center>
						<p:outputLabel value="#{tabela.em_aberto}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</p:outputLabel>
					</center>
				</p:column>


				<p:column headerText="Quantidade" width="10%">
					<center>
						<p:outputLabel value="#{tabela.qtd}" />
					</center>
				</p:column>

				<p:column headerText="Pagar" width="10%">
					<center>
						<p:commandButton icon="confirmar" process="@this" immediate="true"
							action="#{vendaController.limparListaPagamentos}"
							onclick="PF('dlgPagamentos').show();"
							update=":formPagamentos:tabPagamentos">
							<f:setPropertyActionListener value="#{tabela}"
								target="#{vendaController.venda}" />
						</p:commandButton>
					</center>
				</p:column>

			</p:dataTable>

		</h:form>
	</p:dialog>

	<p:dialog widgetVar="dlgPagamentos" header="Inserir Pagamento"
		height="auto" width="auto" draggable="true" resizable="false"
		modal="true">
		<h:form id="formPagamentos">
			<p:growl id="msg2" />
			<p:panelGrid columns="2" styleClass="semBorda" id="pnlgridPagamentos">
				<p:outputLabel value="Valor: " />
				<p:inputText value="#{vendaController.pagamento.valor}"
					maxlength="30" size="15" required="true"
					requiredMessage="Insira o valor" />

				<p:outputLabel value="Data: " />
				<p:calendar value="#{vendaController.pagamento.data}"
					showOn="button" required="true" requiredMessage="Insira a Data"
					size="15"></p:calendar>

			</p:panelGrid>

			<p:separator />

			<center>
				<p:panelGrid columns="2" styleClass="semBorda">
					<p:commandButton value="Pagar"
						action="#{vendaController.inserePagamento()}"
						update=":formPagamentos:tabPagamentos, msg2, :formVender:tabVendas, :formPagamentos:pnlgridPagamentos"
						icon="confirmar" />
					<p:commandButton value="Fechar"
						onclick="PF('dlgPagamentos').hide();" icon="cancelar" />
				</p:panelGrid>
			</center>

			<p:separator />

			<br></br>
			<p:outputPanel autoUpdate="true">
				<p:dataTable id="tabPagamentos"
					value="#{vendaController.listaPagamentos}" var="tabela"
					emptyMessage="Nenhum Pagamento efetuado" rows="10" paginator="true"
					paginatorPosition="bottom">
					<p:column headerText="Valor">
						<center>
							<p:outputLabel value="#{tabela.valor}">
								<f:convertNumber type="currency" currencySymbol="R$" />
							</p:outputLabel>
						</center>
					</p:column>

					<p:column headerText="Data Pagamento">
						<center>
							<p:outputLabel value="#{tabela.data}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:outputLabel>
						</center>
					</p:column>

					<p:column headerText="Data Compra">
						<center>
							<p:outputLabel value="#{tabela.venda.data}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:outputLabel>
						</center>
					</p:column>

				</p:dataTable>
			</p:outputPanel>

		</h:form>
	</p:dialog>


	<p:dialog widgetVar="dlgRelatorios" header="Relatórios" height="70"
		width="auto" draggable="true" resizable="false" modal="true">
		<h:form id="formRel">
			<p:panelGrid columns="4" styleClass="semBorda">
				<p:commandButton value="Ranking por Cliente"
					action="#{vendaController.limparRelatorios}"
					update=":formRel1:tabRel1" onclick="PF('dlgRelatorio1').show();"
					icon="confirmar" />

				<p:commandButton value="A receber por Pessoa"
					action="#{vendaController.limparRelatorios}"
					update=":formRel2:tabRel2" onclick="PF('dlgRelatorio2').show();"
					icon="confirmar" />

				<p:commandButton value="A receber Geral"
				action="#{vendaController.recebidoGeral}" update=":formRel4"
					onclick="PF('dlgRelatorio4').show();" icon="confirmar" />

				<p:commandButton value="Venda por Período"
					onclick="PF('dlgRelatorio3').show();" icon="confirmar" />


			</p:panelGrid>

		</h:form>
	</p:dialog>

	<p:dialog widgetVar="dlgRelatorio1" header="Vendas por Cliente"
		position="top" height="auto" width="auto" draggable="true"
		resizable="false" modal="true">
		<h:form id="formRel1">

			<p:dataTable id="tabRel1"
				value="#{vendaController.listaVendasPorCliente}" var="tabela"
				emptyMessage="Nenhuma venda registrada" rows="20" paginator="true"
				paginatorPosition="bottom">

				<p:column headerText="Cliente">
					<center>
						<p:outputLabel value="#{tabela.cliente.nome}">
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Valor">
					<center>
						<p:outputLabel value="#{tabela.valor}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</p:outputLabel>
					</center>
				</p:column>

			</p:dataTable>

		</h:form>
	</p:dialog>

	<p:dialog widgetVar="dlgRelatorio2" header="Em Aberto" height="auto"
		position="top" width="auto" draggable="true" resizable="false"
		modal="true">
		<h:form id="formRel2">

			<p:dataTable id="tabRel2"
				value="#{vendaController.listaVendasEmAberto}" var="tabela"
				emptyMessage="Nenhuma venda registrada" rows="20" paginator="true"
				paginatorPosition="bottom">

				<p:column headerText="Cliente">
					<center>
						<p:outputLabel value="#{tabela.cliente.nome}">
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Valor">
					<center>
						<p:outputLabel value="#{tabela.valor}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Em Aberto">
					<center>
						<p:outputLabel value="#{tabela.em_aberto}">
							<f:convertNumber type="currency" currencySymbol="R$" />
						</p:outputLabel>
					</center>
				</p:column>

				<p:column headerText="Data Compra">
					<center>
						<p:outputLabel value="#{tabela.data}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</p:outputLabel>
					</center>
				</p:column>

			</p:dataTable>

		</h:form>
	</p:dialog>

	<p:dialog widgetVar="dlgRelatorio3" header="Vendas no Período"
		height="140" width="460" draggable="true" resizable="false"
		modal="true">
		<h:form id="formRel3">
			<p:panelGrid columns="3" styleClass="semBorda">
				<p:calendar id="button"
					value="#{vendaController.busca.periodoinicial}" size="8"
					pattern="dd/MM/yyyy" showOn="button" />

				<h:outputText value="a" style="margin-left: 5px" />

				<p:calendar value="#{vendaController.busca.periodofinal}"
					style="margin-left: 5px" size="8" pattern="dd/MM/yyyy"
					showOn="button" />


				<br></br>
				<br></br>
			</p:panelGrid>

			<p:commandButton value="Buscar" action="#{vendaController.somaGeral}"
				update=":formRel3" icon="financeiro" />

			<h:outputLabel value="TOTAL VENDIDO NO PERÍODO: "
				style="font-size: 14px;margin-left:20px"></h:outputLabel>

			<h:outputLabel value="#{vendaController.soma_geral}"
				style="font-size: 14px;color:red;margin-left:10px">
				<f:convertNumber type="currency" currencySymbol="R$" />
			</h:outputLabel>

		</h:form>
	</p:dialog>


	<p:dialog widgetVar="dlgRelatorio4" header="Total a Receber"
		height="140" width="500" draggable="true" resizable="false"
		modal="true">
		<h:form id="formRel4">
			<p:panelGrid columns="2" styleClass="semBorda">

				<h:outputLabel value="TOTAL VENDIDO ATÉ HOJE: "
					style="font-size: 14px;margin-left:20px"></h:outputLabel>

				<h:outputLabel value="#{vendaController.soma_geral}"
					style="font-size: 14px;color:red;margin-left:10px">
					<f:convertNumber type="currency" currencySymbol="R$" />
				</h:outputLabel>

				<h:outputLabel value="TOTAL RECEBIDO ATÉ HOJE: "
					style="font-size: 14px;margin-left:20px"></h:outputLabel>

				<h:outputLabel value="#{vendaController.receber_geral}"
					style="font-size: 14px;color:red;margin-left:10px">
					<f:convertNumber type="currency" currencySymbol="R$" />
				</h:outputLabel>

				<h:outputLabel value="VALOR TOTAL A RECEBER: "
					style="font-size: 20px;margin-left:20px"></h:outputLabel>

				<h:outputLabel value="#{vendaController.receber_geral_total}"
					style="font-size: 20px;color:red;margin-left:10px">
					<f:convertNumber type="currency" currencySymbol="R$" />
				</h:outputLabel>


			</p:panelGrid>



		</h:form>
	</p:dialog>


</h:body>
</html>

