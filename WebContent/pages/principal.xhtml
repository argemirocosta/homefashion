<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="../template/template.xhtml">

    <ui:define name="content">

        <p:idleMonitor timeout="600000">
            <p:ajax event="idle" listener="#{usuarioMB.timeOut}"/>
        </p:idleMonitor>

        <f:metadata>
            <f:viewAction
                    action="#{clienteMB.listarClientes()}"/>
        </f:metadata>

        <h:form id="formTab">

            <p:growl id="msg"/>

            <p:commandButton value="Sair do Sistema" icon="sair"
                             action="#{usuarioMB.logout()}" style="float:right;"/>

            <p:commandButton value="Relatórios" icon="relatorios"
                             oncomplete="PF('dlgRelatorios').show();"
                             style="float:right;margin-left:10px;margin-right:20px"/>

            <p:outputLabel value="Home Fashion"
                           style="font-size: 30px;font-family:Arial;font-weight: bold"/>

            <p:separator/>

            <br/>
        </h:form>

        <h:form id="formTab2">
            <p:growl id="msg2"/>
            <p:panelGrid columns="7" styleClass="semBorda">

                <p:outputLabel value="Buscar: "/>

                <p:inputText id="cpBuscaNome" value="#{clienteMB.campoBusca}"
                             maxlength="30" size="25">
                    <p:watermark for="cpBuscaNome" value="Digite o nome do cliente"/>
                </p:inputText>

                <p:commandButton value="Pesquisar"
                                 action="#{clienteMB.buscarClientePorNome()}" update=":formTab2"
                                 icon="buscar"/>
                <p:commandButton value="Limpar"
                                 action="#{clienteMB.limparBusca()}" update=":formTab2"
                                 icon="limpar"/>

                <p:commandButton value="Novo Cliente"
                                 oncomplete="PF('dlgCadastrarCliente').show();" icon="novo"/>


            </p:panelGrid>

            <br/>

            <p:dataTable id="tab" value="#{clienteMB.listaClientes}"
                         var="tabela" emptyMessage="Nenhum Cliente encontrado" rows="20"
                         paginator="true" paginatorPosition="bottom">
                <p:column headerText="Código" width="15%">
                    <div align="center">
                        <p:outputLabel value="#{tabela.id}"/>
                    </div>
                </p:column>

                <p:column headerText="Cliente" width="40%">
                    <p:outputLabel value="#{tabela.nome}"/>
                </p:column>

                <p:column headerText="Telefone 1" width="15%">
                    <div align="center">
                        <p:outputLabel value="#{tabela.telefone1}"/>
                    </div>
                </p:column>

                <p:column headerText="Telefone 2" width="15%">
                    <div align="center">
                        <p:outputLabel value="#{tabela.telefone2}"/>
                    </div>
                </p:column>


                <p:column headerText="Ações" width="15%">

                    <div align="center">

                        <p:commandButton oncomplete="PF('dlgAlterarCliente').show();"
                                         update=":formTab2, :formAlt" icon="alterar">
                            <f:setPropertyActionListener value="#{tabela}"
                                                         target="#{clienteMB.cliente}"/>
                        </p:commandButton>

                        <p:commandButton oncomplete="PF('dlgDeletarCliente').show();"
                                         update=":formTab2" icon="cancelar">
                            <f:setPropertyActionListener value="#{tabela}"
                                                         target="#{clienteMB.cliente}"/>
                        </p:commandButton>

                        <p:commandButton oncomplete="PF('dlgVender').show();" icon="sifrao"
                                         action="#{vendaMB.listarVendas()}"
                                         update=":formVender:tabVendas">
                            <f:setPropertyActionListener value="#{tabela}"
                                                         target="#{vendaMB.venda.cliente}"/>
                        </p:commandButton>

                    </div>

                </p:column>

            </p:dataTable>

        </h:form>

        <p:dialog widgetVar="dlgCadastrarCliente" header="Cadastrar Cliente"
                  height="auto" width="auto" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formCad">
                <p:panelGrid columns="2" styleClass="semBorda">
                    <p:outputLabel value="Nome: "/>
                    <p:inputText value="#{clienteMB.cliente.nome}"
                                 maxlength="30" size="25" required="true"
                                 requiredMessage="Insira o nome"/>

                    <p:outputLabel value="Telefone 1: "/>
                    <p:inputText value="#{clienteMB.cliente.telefone1}"
                                 maxlength="30" size="25" required="false"
                                 requiredMessage="Insira ao menos 1 telefone"/>

                    <p:outputLabel value="Telefone 2: "/>
                    <p:inputText value="#{clienteMB.cliente.telefone2}"
                                 maxlength="30" size="25" required="false"
                                 requiredMessage="insira o nome"/>

                </p:panelGrid>

                <p:separator/>

                <div align="center">
                    <p:panelGrid columns="2" styleClass="semBorda">
                        <p:commandButton value="Cadastrar"
                                         action="#{clienteMB.inserirCliente()}"
                                         update=":formCad, :formTab2" icon="confirmar"/>
                        <p:commandButton value="Fechar"
                                         oncomplete="PF('dlgCadastrarCliente').hide();" icon="cancelar"/>
                    </p:panelGrid>
                </div>


            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgAlterarCliente" header="Alterar Cliente"
                  height="auto" width="auto" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formAlt">
                <p:panelGrid columns="2" styleClass="semBorda">
                    <p:outputLabel value="Nome: "/>
                    <p:inputText value="#{clienteMB.cliente.nome}"
                                 maxlength="30" size="25" required="true"
                                 requiredMessage="insira o nome"/>

                    <p:outputLabel value="Telefone 1: "/>
                    <p:inputText value="#{clienteMB.cliente.telefone1}"
                                 maxlength="30" size="25" required="true"
                                 requiredMessage="Insira ao menos 1 telefone"/>

                    <p:outputLabel value="Telefone 2: "/>
                    <p:inputText value="#{clienteMB.cliente.telefone2}"
                                 maxlength="30" size="25" required="false"
                                 requiredMessage="Insira ao menos 1 telefone"/>

                </p:panelGrid>

                <p:separator/>

                <div align="center">
                    <p:panelGrid columns="2" styleClass="semBorda">
                        <p:commandButton value="Alterar"
                                         action="#{clienteMB.alterarCliente()}"
                                         update=":formAlt, :formTab2" icon="confirmar"/>
                        <p:commandButton value="Fechar"
                                         oncomplete="PF('dlgAlterarCliente').hide();" icon="cancelar"/>
                    </p:panelGrid>
                </div>


            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgDeletarCliente" header="Deletar Cliente"
                  height="auto" width="auto" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formDel">
                <p:panelGrid columns="2" styleClass="semBorda">
                    <p:outputLabel value="Deseja realmente deletar esse cliente? "/>

                </p:panelGrid>

                <p:separator/>

                <div align="center">
                    <p:panelGrid columns="2" styleClass="semBorda">
                        <p:commandButton value="Sim"
                                         action="#{clienteMB.deletarCliente()}"
                                         update=":formAlt, :formTab2" icon="confirmar"/>
                        <p:commandButton value="Fechar"
                                         oncomplete="PF('dlgDeletarCliente').hide();" icon="cancelar"/>
                    </p:panelGrid>
                </div>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgVender" header="Realizar Vendas" height="auto"
                  width="auto" draggable="true" resizable="false" modal="true"
                  position="top">
            <h:form id="formVender">
                <p:panelGrid columns="2" styleClass="semBorda" id="pnlgridVender">
                    <p:outputLabel value="Valor: "/>
                    <p:inputText value="#{vendaMB.venda.valor}" maxlength="30"
                                 size="15" required="true" requiredMessage="Insira o valor"/>

                    <p:outputLabel value="Data: "/>
                    <p:calendar value="#{vendaMB.venda.data}" showOn="button"
                                required="true" requiredMessage="Insira a Data" size="15"></p:calendar>

                    <p:outputLabel value="Quantidade: "/>
                    <p:inputText value="#{vendaMB.venda.qtd}" maxlength="30"
                                 size="15" required="false" requiredMessage="Insira a quantidade"/>

                </p:panelGrid>

                <p:separator/>

                <div align="center">
                    <p:panelGrid columns="2" styleClass="semBorda">
                        <p:commandButton value="Vender"
                                         action="#{vendaMB.inserirVenda()}"
                                         update=":formCad, :formTab2, :formVender:pnlgridVender"
                                         icon="carrinho"/>
                        <p:commandButton value="Fechar" oncomplete="PF('dlgVender').hide();"
                                         icon="cancelar"/>
                    </p:panelGrid>
                </div>

                <p:separator/>

                <br></br>

                <p:dataTable id="tabVendas" value="#{vendaMB.listaVendas}"
                             var="tabela"
                             emptyMessage="Nenhuma venda realizada para esse cliente" rows="10"
                             paginator="true" paginatorPosition="bottom"
                             rowStyleClass="#{tabela.situacao == 'ABERTO' ? 'rowRed' : null} ">

                    <p:column headerText="Cliente" width="30%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.cliente.nome}"/>
                        </div>
                    </p:column>

                    <p:column headerText="Data" width="10%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.data}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </p:outputLabel>
                        </div>
                    </p:column>

                    <p:column headerText="Valor Venda" width="10%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.valor}">
                                <f:convertNumber type="currency" currencySymbol="R$"/>
                            </p:outputLabel>
                        </div>
                    </p:column>

                    <p:column headerText="Total Pago" width="10%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.totalPago}">
                                <f:convertNumber type="currency" currencySymbol="R$"/>
                            </p:outputLabel>
                        </div>
                    </p:column>

                    <p:column headerText="Em Aberto" width="10%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.emAberto}">
                                <f:convertNumber type="currency" currencySymbol="R$"/>
                            </p:outputLabel>
                        </div>
                    </p:column>

                    <p:column headerText="Situação" width="10%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.situacao}">
                            </p:outputLabel>
                        </div>
                    </p:column>

                    <p:column headerText="Quantidade" width="10%">
                        <div align="center">
                            <p:outputLabel value="#{tabela.qtd}"/>
                        </div>
                    </p:column>

                    <p:column headerText="Pagar" width="10%">
                        <div align="center">
                            <p:commandButton icon="calculadora" process="@this"
                                             immediate="true"
                                             action="#{vendaMB.listarPagamentos()}"
                                             oncomplete="PF('dlgPagamentos').show();"
                                             update=":formPagamentos:tabPagamentos">
                                <f:setPropertyActionListener value="#{tabela}"
                                                             target="#{vendaMB.venda}"/>
                            </p:commandButton>
                        </div>
                    </p:column>

                </p:dataTable>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgPagamentos" header="Inserir Pagamento"
                  height="auto" width="auto" draggable="true" resizable="false"
                  modal="true" position="top">
            <h:form id="formPagamentos">
                <p:growl id="msg3"/>
                <p:panelGrid columns="2" styleClass="semBorda" id="pnlgridPagamentos">
                    <p:outputLabel value="Valor: "/>
                    <p:inputText value="#{vendaMB.pagamento.valor}"
                                 maxlength="30" size="15" required="true"
                                 requiredMessage="Insira o valor"/>

                    <p:outputLabel value="Data: "/>
                    <p:calendar value="#{vendaMB.pagamento.data}"
                                showOn="button" required="true" requiredMessage="Insira a Data"
                                size="15"></p:calendar>

                </p:panelGrid>

                <p:separator/>

                <div align="center">
                    <p:panelGrid columns="2" styleClass="semBorda">
                        <p:commandButton value="Pagar"
                                         action="#{vendaMB.inserirPagamento()}"
                                         update=":formPagamentos:tabPagamentos, msg3, :formVender:tabVendas, :formPagamentos:pnlgridPagamentos"
                                         icon="calculadorasifrao"/>
                        <p:commandButton value="Fechar"
                                         oncomplete="PF('dlgPagamentos').hide();" icon="cancelar"/>
                    </p:panelGrid>
                </div>

                <p:separator/>

                <br></br>
                <p:outputPanel autoUpdate="true">
                    <p:dataTable id="tabPagamentos"
                                 value="#{vendaMB.listaPagamentos}" var="tabela"
                                 emptyMessage="Nenhum Pagamento efetuado" rows="10" paginator="true"
                                 paginatorPosition="bottom">
                        <p:column headerText="Valor">
                            <div align="center">
                                <p:outputLabel value="#{tabela.valor}">
                                    <f:convertNumber type="currency" currencySymbol="R$"/>
                                </p:outputLabel>
                            </div>
                        </p:column>

                        <p:column headerText="Data Pagamento">
                            <div align="center">
                                <p:outputLabel value="#{tabela.data}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </div>
                        </p:column>

                        <p:column headerText="Data Compra">
                            <div align="center">
                                <p:outputLabel value="#{tabela.venda.data}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </div>
                        </p:column>

                    </p:dataTable>
                </p:outputPanel>

            </h:form>
        </p:dialog>


        <p:dialog widgetVar="dlgRelatorios" header="Relatórios"
                  height="auto" width="auto" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formRel">
                <p:panelGrid columns="4" styleClass="semBorda">
                    <p:commandButton value="Ranking por Cliente"
                                     action="#{vendaMB.listarRankingDosClientes()}"
                                     update=":formRel1:tabRel1" oncomplete="PF('dlgRelatorioRanking').show();"
                                     icon="confirmar"/>

                    <p:commandButton value="A receber por Pessoa"
                                     action="#{vendaMB.listarValorAReceberPorPessoa()}"
                                     update=":formRel2:tabRel2" oncomplete="PF('dlgRelatorioReceberPorPessoa').show();"
                                     icon="confirmar"/>

                    <p:commandButton value="A receber Geral"
                                     action="#{vendaMB.calcularRecebidoGeral()}" update=":formRel4"
                                     oncomplete="PF('dlgRelatorioReceberGeral').show();" icon="confirmar"/>

                    <p:commandButton value="Venda por Período"
                                     oncomplete="PF('dlgRelatorioVendaPorPeriodo').show();" icon="confirmar"/>

                </p:panelGrid>

                <br></br>

                <div align="center">
                    <p:commandButton value="Fechar"
                                     oncomplete="PF('dlgRelatorios').hide();" icon="cancelar"/>
                </div>

                <br></br>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgRelatorioRanking"
                  header="Ranking de Vendas por Cliente" position="top" height="auto"
                  width="auto" draggable="true" resizable="false" modal="true">
            <h:form id="formRel1">

                <p:dataTable id="tabRel1"
                             value="#{vendaMB.listaVendasPorCliente}" var="tabela"
                             emptyMessage="Nenhuma venda registrada" rows="15" paginator="true"
                             paginatorPosition="bottom">
                    <div align="center">
                        <p:column headerText="Cliente">
                            <p:outputLabel value="#{tabela.cliente.nome}"/>
                        </p:column>

                        <p:column headerText="Valor">
                            <p:outputLabel value="#{tabela.valor}">
                                <f:convertNumber type="currency" currencySymbol="R$"/>
                            </p:outputLabel>
                        </p:column>

                    </div>

                </p:dataTable>

                <p:panelGrid columns="3">
                    <div align="center">
                        <h3>Opções para Exportar:</h3>

                        <h:commandLink>
                            <p:graphicImage title="CSV" value="../imgs/csv.png" width="24"/>
                            <p:dataExporter type="csv" target="tabRel1" fileName="Ranking"/>
                        </h:commandLink>

                        <h:commandLink>
                            <p:graphicImage title="PDF" value="../imgs/pdf.png" width="24"/>
                            <p:dataExporter type="pdf" target="tabRel1" fileName="Ranking"/>
                        </h:commandLink>

                    </div>

                </p:panelGrid>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgRelatorioReceberPorPessoa" header="Em Aberto" height="auto"
                  position="top" width="auto" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formRel2">

                <p:dataTable id="tabRel2"
                             value="#{vendaMB.listaVendasEmAberto}" var="tabela"
                             emptyMessage="Nenhuma venda registrada" rows="15" paginator="true"
                             paginatorPosition="bottom">

                    <p:column headerText="Cliente" sortBy="#{tabela.cliente.nome}"
                              filterBy="#{tabela.cliente.nome}">
                        <p:outputLabel value="#{tabela.cliente.nome}"/>
                    </p:column>

                    <p:column headerText="Valor" sortBy="#{tabela.valor}">
                        <p:outputLabel value="#{tabela.valor}">
                            <f:convertNumber type="currency" currencySymbol="R$"/>
                        </p:outputLabel>
                    </p:column>

                    <p:column headerText="Em Aberto" sortBy="#{tabela.emAberto}">
                        <p:outputLabel value="#{tabela.emAberto}">
                            <f:convertNumber type="currency" currencySymbol="R$"/>
                        </p:outputLabel>
                    </p:column>

                    <p:column headerText="Data Compra" sortBy="#{tabela.data}">
                        <p:outputLabel value="#{tabela.data}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </p:outputLabel>
                    </p:column>

                </p:dataTable>

                <p:panelGrid columns="3">

                    <div align="center">
                        <h3>Opções para Exportar:</h3>

                        <h:commandLink>
                            <p:graphicImage title="CSV" value="../imgs/csv.png" width="24"/>
                            <p:dataExporter type="csv" target="tabRel2" fileName="ReceberPorPessoa"/>
                        </h:commandLink>

                        <h:commandLink>
                            <p:graphicImage title="PDF" value="../imgs/pdf.png" width="24"/>
                            <p:dataExporter type="pdf" target="tabRel2" fileName="ReceberPorPessoa"/>
                        </h:commandLink>

                    </div>

                </p:panelGrid>

            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dlgRelatorioVendaPorPeriodo" header="Vendas no Período"
                  height="140" width="460" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formRel3">
                <p:panelGrid columns="3" styleClass="semBorda">

                    <p:calendar id="button"
                                value="#{vendaMB.busca.periodoinicial}" size="12"
                                pattern="dd/MM/yyyy" showOn="button"/>

                    <h:outputText value="a" style="margin-left: 5px"/>

                    <p:calendar value="#{vendaMB.busca.periodofinal}"
                                style="margin-left: 5px" size="12" pattern="dd/MM/yyyy"
                                showOn="button"/>


                    <br></br>
                    <br></br>
                </p:panelGrid>

                <p:commandButton value="Buscar" action="#{vendaMB.totalVendidoPeriodo()}"
                                 update=":formRel3" icon="buscar"/>

                <h:outputLabel value="TOTAL VENDIDO NO PERÍODO: "
                               style="font-size: 14px;margin-left:20px"></h:outputLabel>

                <h:outputLabel value="#{vendaMB.totalVendidoNoPeriodo}"
                               style="font-size: 14px;color:red;margin-left:10px">
                    <f:convertNumber type="currency" currencySymbol="R$"/>
                </h:outputLabel>

            </h:form>
        </p:dialog>


        <p:dialog widgetVar="dlgRelatorioReceberGeral" header="Total a Receber"
                  height="140" width="500" draggable="true" resizable="false"
                  modal="true">
            <h:form id="formRel4">
                <p:panelGrid columns="2" styleClass="semBorda">

                    <h:outputLabel value="TOTAL VENDIDO ATÉ HOJE: "
                                   style="font-size: 14px;margin-left:20px"></h:outputLabel>

                    <h:outputLabel value="#{vendaMB.totalVendidoNoPeriodo}"
                                   style="font-size: 14px;color:red;margin-left:10px">
                        <f:convertNumber type="currency" currencySymbol="R$"/>
                    </h:outputLabel>

                    <h:outputLabel value="TOTAL RECEBIDO ATÉ HOJE: "
                                   style="font-size: 14px;margin-left:20px"></h:outputLabel>

                    <h:outputLabel value="#{vendaMB.valorReceberGeral}"
                                   style="font-size: 14px;color:red;margin-left:10px">
                        <f:convertNumber type="currency" currencySymbol="R$"/>
                    </h:outputLabel>

                    <h:outputLabel value="VALOR TOTAL A RECEBER: "
                                   style="font-size: 20px;margin-left:20px"></h:outputLabel>

                    <h:outputLabel value="#{vendaMB.valorReceberGeralTotal}"
                                   style="font-size: 20px;color:red;margin-left:10px">
                        <f:convertNumber type="currency" currencySymbol="R$"/>
                    </h:outputLabel>

                </p:panelGrid>

            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>

